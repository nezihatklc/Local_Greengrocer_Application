<?xml version="1.0" encoding="UTF-8"?>

<!--
 
  Purpose:
  - Base OWNER screen layout.
  - Left side lists products in a TableView (Week11: TableView).
  - Right side will contain the Add/Update form (next step).

  Week11 Concepts Used:
  - fx:controller  -> binds this FXML to the controller class.
  - fx:id          -> binds UI nodes to @FXML fields in the controller.
  - onAction       -> binds button events to controller methods (#handleX).
  - BorderPane     -> region-based layout (top/center).
  - SplitPane      -> splits the screen into two resizable panels.

  Project Rules Reminder (rules.md):
  - Controllers must NOT run SQL.
  - Controllers call Service methods.
  - Business logic is in Service; raw DB work is in DAO.
-->

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns="http://javafx.com/javafx/8"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.group18.greengrocer.controller.OwnerController">

    <!-- TOP: Header bar -->
    <top>
        <HBox spacing="10">
            <padding>
                <Insets top="10" right="10" bottom="10" left="10"/>
            </padding>
            <Label text="Owner Dashboard"
                   style="-fx-font-size: 18px; -fx-font-weight: bold;"/>

            <!-- Spacer: pushes username to the right -->
            <Region HBox.hgrow="ALWAYS"/>

            <!-- Logged-in user info (filled by Controller using SessionManager later) -->
            <Label text="User:"/>
            <Label fx:id="usernameLabel" text="-" />
            <Button fx:id="backButton" text="Back" onAction="#handleBack"/>
            <Button fx:id="logoutButton" text="Logout" onAction="#handleLogout"/>

        </HBox>
    </top>

    <!-- CENTER: Main content with Tabs -->
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE">
            
            <!-- TAB 1: Products (Existing Interface) -->
            <Tab text="Products">
                <SplitPane dividerPositions="0.60">

                    <!-- LEFT: Product list (TableView) -->
                    <VBox spacing="10">
                        <padding>
                            <Insets top="10" right="10" bottom="10" left="10"/>
                        </padding>
                        <Label text="All Products (Owner View)"
                               style="-fx-font-size: 14px; -fx-font-weight: bold;"/>

                        <!--
                          TableView rows will be loaded in OwnerController using ProductService.
                          Columns will be bound to Product fields in the controller (PropertyValueFactory).
                        -->
                        <TableView fx:id="productTable" prefHeight="420">
                            <columns>
                                <TableColumn fx:id="idCol" text="ID" prefWidth="60"/>
                                <TableColumn fx:id="nameCol" text="Name" prefWidth="150"/>
                                <TableColumn fx:id="categoryCol" text="Category" prefWidth="110"/>
                                <TableColumn fx:id="typeCol" text="Type" prefWidth="120"/>
                                <TableColumn fx:id="unitCol" text="Unit" prefWidth="70"/>
                                <TableColumn fx:id="priceCol" text="Price" prefWidth="90"/>
                                <TableColumn fx:id="stockCol" text="Stock" prefWidth="90"/>
                                <TableColumn fx:id="thresholdCol" text="Threshold" prefWidth="100"/>
                            </columns>
                        </TableView>

                        <!-- Action buttons -->
                        <HBox spacing="10">
                            <!-- Week11: onAction -> calls OwnerController.handleRefresh() -->
                            <Button text="Refresh" onAction="#handleRefresh"/>

                            <!-- Week11: onAction -> calls OwnerController.handleDelete() -->
                            <Button text="Delete Selected" onAction="#handleDelete"/>

                            <Region HBox.hgrow="ALWAYS"/>

                            <!-- Shows the computed effective price (threshold rule) -->
                            <Label text="Effective Price:"/>
                            <Label fx:id="effectivePriceLabel" text="-" />
                        </HBox>
                    </VBox>

                    <!-- RIGHT: Product Form -->
                    <VBox spacing="10">
                        <padding>
                            <Insets top="10" right="10" bottom="10" left="10"/>
                        </padding>
                        <Label text="Product Details" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        
                        <GridPane hgap="10" vgap="10">
                            <padding><Insets top="10" right="10" bottom="10" left="0"/></padding>
                            
                            <Label text="Name:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <TextField fx:id="nameField" promptText="e.g. Apple" GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                            
                            <Label text="Category:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <ComboBox fx:id="categoryCombo" promptText="Select Category" prefWidth="150" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                            
                            <Label text="Type:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <TextField fx:id="typeField" promptText="e.g. Golden" GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                            
                            <Label text="Unit:" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                            <TextField fx:id="unitField" promptText="e.g. kg" GridPane.rowIndex="3" GridPane.columnIndex="1"/>
                            
                            <Label text="Price (â‚º):" GridPane.rowIndex="4" GridPane.columnIndex="0"/>
                            <TextField fx:id="priceField" promptText="0.00" GridPane.rowIndex="4" GridPane.columnIndex="1"/>
                            
                            <Label text="Stock:" GridPane.rowIndex="5" GridPane.columnIndex="0"/>
                            <TextField fx:id="stockField" promptText="0.0" GridPane.rowIndex="5" GridPane.columnIndex="1"/>
                            
                            <Label text="Threshold:" GridPane.rowIndex="6" GridPane.columnIndex="0"/>
                            <TextField fx:id="thresholdField" promptText="Low stock alert level" GridPane.rowIndex="6" GridPane.columnIndex="1"/>
                        </GridPane>

                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button text="Add New" fx:id="addButton" onAction="#handleAdd" style="-fx-base: #4CAF50;"/>
                            <Button text="Update" fx:id="updateButton" onAction="#handleUpdate" style="-fx-base: #2196F3;"/>
                            <Button text="Clear Form" onAction="#handleClear"/>
                        </HBox>

                        <Label text="* Threshold Rule: If Stock <= Threshold, Price is doubled automatically." 
                               wrapText="true" style="-fx-text-fill: gray; -fx-font-size: 10px;"/>
                    </VBox>

                </SplitPane>
            </Tab>

            <!-- TAB 2: Carrier Management -->
            <Tab text="Carriers">
                <SplitPane dividerPositions="0.65">
                    
                    <!-- LEFT: Carrier List -->
                    <VBox spacing="10">
                        <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                        <Label text="Employees (Carriers)" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                        
                        <TableView fx:id="carrierTable" prefHeight="400">
                            <columns>
                                <TableColumn fx:id="carrierIdCol" text="ID" prefWidth="50"/>
                                <TableColumn fx:id="carrierNameCol" text="Username" prefWidth="120"/>
                                <TableColumn fx:id="carrierPhoneCol" text="Phone" prefWidth="120"/>
                                <TableColumn fx:id="carrierAddressCol" text="Address" prefWidth="150"/>
                                <!-- Optional: Rating Column if needed later -->
                            </columns>
                        </TableView>

                        <HBox spacing="10">
                            <Button text="Refresh List" onAction="#handleRefreshCarriers"/>
                            <Button text="Fire Selected" onAction="#handleFireCarrier" style="-fx-text-fill: red;"/>
                        </HBox>
                    </VBox>

                    <!-- RIGHT: Hire New Carrier Form -->
                    <VBox spacing="10">
                        <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                        <Label text="Hire New Carrier" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        
                        <Label text="Username:"/>
                        <TextField fx:id="carrierUsernameField" promptText="Login username"/>

                        <Label text="Password:"/>
                        <PasswordField fx:id="carrierPasswordField" promptText="Strong password"/>

                        <Label text="Phone:"/>
                        <TextField fx:id="carrierPhoneField" promptText="10-13 digits"/>

                        <Label text="Address:"/>
                        <TextArea fx:id="carrierAddressArea" prefRowCount="3" wrapText="true" promptText="Full address"/>

                        <Button text="Hire (Register)" onAction="#handleHireCarrier" 
                                style="-fx-base: #4CAF50; -fx-font-weight: bold;" maxWidth="Infinity"/>
                        
                        <Label text="* Default role will be CARRIER." style="-fx-text-fill: gray;"/>
                    </VBox>

                </SplitPane>
            </Tab>

        </TabPane>
    </center>

</BorderPane>
